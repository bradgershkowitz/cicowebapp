<%# contains the table used in the dashboard%>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <style>
        /* This styling is needed to allow the numbers inputs to not use text */

        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            margin: 0;
        }
    </style>
    <div class="panel panel-default">
        <div class="panel-body">
            <div class="tbl_day_data"></div>

            <div id="food-diary" class="container">
                <div id="food-diary" class="table-wrapper">
                    <div id="food-diary" class="table-title">
                        <div class="row">
                            <div class="col-sm-6">
                                <h4>
                                    <b>Blood Pressure Log</b>
                                </h4>
                            </div>
                            <div class="col-sm-6">
                                <a href="#addEmployeeModal" class="btn btn-add" data-toggle="modal">
                                    <i class="material-icons">&#xE147;</i>
                                    <span>Add Entry</span>
                                </a>
                                <a href="#deleteEmployeeModal" class="btn btn-delete" data-toggle="modal">
                                    <i class="material-icons">&#xE15C;</i>
                                    <span>Delete</span>
                                </a>
                            </div>
                        </div>
                    </div>

                    <table id="food_table" class="table table-striped table-hover">

                        <!-- The head of the table is one row, does not need to be rendered -->
                        <thead>
                            <tr>
                                <th>
                                    <span class="custom-checkbox">
                                        <input type="checkbox" id="checkbox1" name="options[]" value="1">
                                        <label for="checkbox1"></label>
                                    </span>
                                </th>
                                <th>Time</th>
                                <th>Systolic BP (mmHg)</th>
                                <th>Diastolic BP (mmHg)</th>
                                <th>Heart Rate (bpm)</th>
                                <th>Notes</th>
                                <th></th>
                            </tr>
                        </thead>

                        <!-- Table body is multiple rows, each row needs rendered using jquery and database requests -->
                        <tbody>

                            <!-- Each row gets rendered using a database request-->
                            <%if (typeof days.bloodPressures != 'undefined') { %>
                                <% days.bloodPressures.forEach(function(bloodPressures) { %>
                                    <tr id="<%= bloodPressures._id %>">
                                        <td>
                                            <span class="custom-checkbox">
                                                <input type="checkbox" id="checkbox1" name="options[]" value="1">
                                                <label for="checkbox1"></label>
                                            </span>
                                        </td>
                                        <td class="name_data">
                                            <%= bloodPressures.time %>
                                        </td>
                                        <td class="row_data" column_name="systolicBP_data">
                                            <%if (typeof bloodPressures.systolicBP != 'undefined') { %>
                                                <%= bloodPressures.systolicBP %>
                                                    <% } else { %>
                                                        <%= NR %>
                                                            <% } %>
                                        </td>
                                        <td class="row_data" column_name="diastolicBP_data">
                                            <%if (typeof bloodPressures.diastolicBP != 'undefined') { %>
                                                <%= bloodPressures.diastolicBP %>
                                                    <% } else { %>
                                                        <%= NR %>
                                                            <% } %>
                                        </td>
                                        <td class="row_data" column_name="heartRate_data">
                                            <%if (typeof bloodPressures.heartRate != 'undefined') { %>
                                                <%= bloodPressures.heartRate %>
                                                    <% } else { %>
                                                        <%= NR %>
                                                            <% } %>
                                        </td>
                                        <td class="row_data" column_name="notes_data">
                                            <%if (typeof bloodPressures.notes != 'undefined') { %>
                                                <%= bloodPressures.notes %>
                                                    <% } else { %>
                                                        <%= None %>
                                                            <% } %>
                                        </td>
                                        <td>
                                            <a href="#editEmployeeModal" class="edit" data-toggle="modal">
                                                <i class="material-icons" data-toggle="tooltip" title="Edit">&#xE254;</i>
                                            </a>
                                            <a href="#deleteEmployeeModal" class="delete" data-toggle="modal">
                                                <i class="material-icons" data-toggle="tooltip" title="Delete">&#xE872;</i>
                                            </a>
                                        </td>
                                    </tr>
                                    <% }); %>
                                        <% } %>
                                            <tr id="totals_row"></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Add Modal HTML -->
            <div id="addEmployeeModal" class="modal fade">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <form action="/days/addBP" method="POST" autocomplete="off">
                            <div class="modal-header">
                                <h4 class="modal-title">Add Entry</h4>
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                            </div>
                            <div class="modal-body">
                                <div class="form-group">
                                    <label>Time</label>
                                    <input type="time" name="time" class="form-control" required maxlength="25" onclick="this.select()">
                                </div>
                                <div class="form-group">
                                    <label>Systolic BP</label>
                                    <input type="number" name="systolicBP" class="form-control" value="" maxlength="3" onclick="this.select()">
                                </div>
                                <div class="form-group">
                                    <label>Diastolic BP</label>
                                    <input type="number" name="diastolicBP" class="form-control" value="" maxlength="3" onclick="this.select()">
                                </div>
                                <div class="form-group">
                                    <label>Heart Rate</label>
                                    <input type="number" name="heartRate" class="form-control" value="" maxlength="3" onclick="this.select()">
                                </div>
                                <div class="form-group">
                                    <label>Notes</label>
                                    <textarea class="form-control" id="notes" rows="3" name="notes" class="form-control" value="" maxlength="140" onclick="this.select()" ></textarea>
                                  </div>
                                <input type="hidden" name="date" value="<%= days.date %>" />
                                <input type="hidden" name="dateString" value="<%= days.dateString %>" />
                            </div>
                            <div class="modal-footer">
                                <input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
                                <input type="submit" class="btn btn-success" value="Add">
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Edit Modal HTML -->
            <div id="editEmployeeModal" class="modal fade">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <form action="/days/editBP" method="POST" autocomplete="off">
                            <div class="modal-header">
                                <h4 class="modal-title">Edit Entry</h4>
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                            </div>
                            <div class="modal-body">
                                <div class="form-group">
                                    <label>Time</label>
                                    <input type="text" name="time" class="form-control name_row_data" value="new entry" maxlength="25" required onclick="this.select()">
                                </div>
                                <div class="form-group">
                                    <label>Systolic BP</label>
                                    <input type="number" name="systolicBP" class="form-control edit_row_data" value="0" maxlength="10" required onclick="this.select()">
                                </div>
                                <div class="form-group">
                                    <label>Diastolic BP</label>
                                    <input type="number" name="diastolicBP" class="form-control edit_row_data" value="0" maxlength="10" required onclick="this.select()">
                                </div>
                                <div class="form-group">
                                    <label>Heart Rate</label>
                                    <input type="number" name="heartRate" class="form-control edit_row_data" value="0" required maxlength="10" onclick="this.select()">
                                </div>
                                <div class="form-group">
                                    <label>Notes</label>
                                    <input type="text" name="notes" class="form-control edit_row_data" value="" maxlength="140" onclick="this.select()">
                                </div>
                                <input type="hidden" name="date" value="<%= days.date %>" />
                                <input type="hidden" name="dateString" value="<%= days.dateString %>" />
                                <input class="row_id_data" type="hidden" name="row_id" value="" />
                            </div>
                            <div class="modal-footer">
                                <input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
                                <input type="submit" class="btn btn-info" value="Save">
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Delete Modal HTML -->
            <div id="deleteEmployeeModal" class="modal fade">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <form action="/days/deleteBP" method="POST" autocomplete="off">
                            <div class="modal-header">
                                <h4 class="modal-title">Delete Entry</h4>
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                            </div>
                            <div class="modal-body">
                                <p>Are you sure you want to delete this entry?</p>
                                <p class="text-warning">
                                    <small>This action cannot be undone.</small>
                                </p>
                                <input type="hidden" name="date" value="<%= days.date %>" />
                                <input type="hidden" name="dateString" value="<%= days.dateString %>" />
                                <input class="row_id_data" type="hidden" name="row_id" value="" />
                            </div>
                            <div class="modal-footer">
                                <input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
                                <input type="submit" class="btn btn-danger" value="Delete">
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        $(document).ready(function ($) {

            //click the edit button
            $(document).on('click', '.edit', function (event) {

                //may need this?
                event.preventDefault();

                //find tbl row and its ID closest to the click, will be used to update the db
                var tbl_row = $(this).closest('tr');
                var id = tbl_row.attr('id');

                var temp_row_data = [];
                let i = 0;

                //get new name
                var name = tbl_row.find('.name_data').html();
                name = name.trim();
                $("#editEmployeeModal").find('.name_row_data').attr("value", name);

                //get row id
                $("#editEmployeeModal").find('.row_id_data').attr("value", id);
                //take each value in the actual row data and update the default value for the edit form
                tbl_row.find('.row_data').each(function (index, val) {

                    //for each value of the row store to array, need to get the int out of it
                    temp_row_data[i] = parseInt(($(this).html()));
                    i++;

                });

                //for each value in the edit form, we update with the temporary data
                let j = 0;
                $("#editEmployeeModal").find('.edit_row_data').each(function (index, val) {

                    //update edit form
                    $(this).attr("value", temp_row_data[j]);
                    j++;

                });
            });

            $(document).on('click', '.delete', function (event) {

                //may need this?
                event.preventDefault();

                //find tbl row and its ID closest to the click, will be used to update the db
                var tbl_row = $(this).closest('tr');
                var id = tbl_row.attr('id');

                //update row id in the submit form
                $("#deleteEmployeeModal").find('.row_id_data').attr("value", id);
            });

        });
    </script>